<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Notes</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 内联样式确保立即生效 */
        .page-title {
            text-align: center;
            margin: 2rem 0;
            color: #2c3e50;
        }
        
        .page-title h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        
        .page-title p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        /* 浮动工具栏样式 */
        .floating-toolbar {
            position: fixed;
            z-index: 1000;
            background: var(--background-white);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 0.5rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            animation: fadeInUp 0.2s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .floating-toolbar .editor-btn {
            min-width: 32px;
            height: 32px;
        }

        /* 内容编辑器滚动 */
        #noteContent {
            max-height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">IELTS Notes</a>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="listening.html">Listening</a></li>
                <li><a href="reading.html" class="active">Reading</a></li>
                <li><a href="speaking.html">Speaking</a></li>
                <li><a href="writing.html">Writing</a></li>
                <li><a href="vocabulary-reading.html">Vocabulary</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- 简化的页面标题 -->
        <div class="page-title">
            <h1><i class="fas fa-book-reader"></i> Reading Notes</h1>
            <p>Search and manage your IELTS reading study articles</p>
        </div>

        <!-- 搜索区域 -->
        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="noteSearch" placeholder="Search articles by chapter, test, passage, or keywords...">
                <button id="clearSearch" class="btn-clear">
                    Clear
                </button>
            </div>
            <div class="search-stats">
                <span id="noteCount">Loading articles...</span>
            </div>
        </div>
        
        <!-- Add Article Button -->
        <div class="add-note-section">
            <button class="btn-add-note" id="addNoteBtn">
                <i class="fas fa-plus-circle"></i> Add New Article
            </button>
        </div>

        <!-- 笔记卡片网格 -->
        <div class="notes-grid" id="notesGrid">
            <!-- 动态生成的笔记卡片将显示在这里 -->
        </div>
    </main>

    <!-- 添加/编辑笔记模态框 -->
    <div class="modal" id="addNoteModal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Article</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="noteForm">
                    <!-- Basic Information Row -->
                    <div class="form-row">
                        <!-- Chapter -->
                        <div class="form-group">
                            <label for="noteChapter">
                                <i class="fas fa-book"></i> Chapter <span class="required">*</span>
                            </label>
                            <input type="text" id="noteChapter" name="chapter" class="form-control" 
                                   placeholder="e.g., C1, C2, C3" required>
                        </div>

                        <!-- Test Selection -->
                        <div class="form-group">
                            <label for="noteTest">
                                <i class="fas fa-file-alt"></i> Test <span class="required">*</span>
                            </label>
                            <select id="noteTest" name="test" class="form-control" required>
                                <option value="">Select Test</option>
                                <option value="Test1">Test 1</option>
                                <option value="Test2">Test 2</option>
                                <option value="Test3">Test 3</option>
                                <option value="Test4">Test 4</option>
                            </select>
                        </div>

                        <!-- Part Selection -->
                        <div class="form-group">
                            <label for="notePart">
                                <i class="fas fa-layer-group"></i> Passage <span class="required">*</span>
                            </label>
                            <select id="notePart" name="part" class="form-control" required>
                                <option value="">Select Passage</option>
                                <option value="Passage1">Passage 1</option>
                                <option value="Passage2">Passage 2</option>
                                <option value="Passage3">Passage 3</option>
                            </select>
                        </div>
                    </div>

                    <!-- Title -->
                    <div class="form-group">
                        <label for="noteTitle">
                            <i class="fas fa-heading"></i> Article Title
                        </label>
                        <input type="text" id="noteTitle" name="title" class="form-control" 
                               placeholder="Enter article title (optional)">
                    </div>

                    <div class="form-group">
                        <label for="noteContent">
                            <i class="fas fa-align-left"></i> Content <span class="required">*</span>
                        </label>
                        <div class="editor-toolbar" id="contentToolbar">
                            <button type="button" class="editor-btn" data-command="bold" title="Bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="italic" title="Italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="underline" title="Underline">
                                <i class="fas fa-underline"></i>
                            </button>
                            <button type="button" class="editor-btn color-toggle" title="Text Color">
                                A
                            </button>
                            <button type="button" class="editor-btn" data-command="insertUnorderedList" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="insertOrderedList" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="editor-btn" id="formatParagraphsBtn" title="Format Paragraphs (Add blank lines between paragraphs)">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 2h12M2 5h10M2 8h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    <path d="M2 11h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-dasharray="2 2"/>
                                </svg>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="editor-btn btn-add-note" id="addNoteToSelection" title="Add Note to Selected Text">
                                <i class="fas fa-sticky-note"></i> Add Note
                            </button>
                            <button type="button" class="editor-btn btn-add-vocab" id="addToVocabulary" title="Add Selected Word to Vocabulary">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 2h12v12H2V2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M5 6h6M5 9h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>
                        <div id="noteContent" class="form-control" contenteditable="true" placeholder="Enter article content..." style="max-height: 500px; overflow-y: auto;"></div>
                        
                        <!-- 浮动工具栏 -->
                        <div id="floatingToolbar" class="floating-toolbar" style="display: none;">
                            <button type="button" class="editor-btn" data-command="bold" title="Bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="italic" title="Italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="underline" title="Underline">
                                <i class="fas fa-underline"></i>
                            </button>
                            <button type="button" class="editor-btn color-toggle" id="floatingColorToggle" title="Text Color">
                                A
                            </button>
                            <button type="button" class="editor-btn" data-command="insertUnorderedList" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="editor-btn" data-command="insertOrderedList" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Questions & Error Reasons Pairs -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-question-circle"></i> Questions & Error Reasons
                        </label>
                        <div id="questionErrorPairsContainer">
                            <!-- Question and error reason pairs will be dynamically added here -->
                        </div>
                        <button type="button" class="btn-add-question-pair" id="addQuestionErrorPairBtn">
                            <i class="fas fa-plus-circle"></i> Add Question & Error Reason
                        </button>
                        <small class="form-hint">You can add multiple questions with their corresponding error reasons</small>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-save"></i> Save Article
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 笔记详情模态框 -->
    <div class="modal" id="noteDetailsModal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h3 id="detailsTitle">Note Details</h3>
                <div class="modal-header-actions">
                    <button type="button" class="btn-modal-action btn-edit-note" id="editNoteBtn" style="display: none;">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button type="button" class="btn-modal-action btn-delete-note-modal" id="deleteNoteBtn" style="display: none;">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                    <button class="modal-close" id="closeDetailsModal">&times;</button>
                </div>
            </div>
            <div class="modal-body" id="noteDetailsContent">
                <div class="note-view-layout">
                    <div class="note-view-left">
                        <div id="noteViewLeftContent">
                            <!-- 文章内容将显示在这里 -->
                        </div>
                    </div>
                    <div class="note-view-right">
                        <div id="noteViewRightContent">
                            <!-- 问题和错误原因将显示在这里 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Note Modal (for content notes) -->
    <div class="modal" id="addContentNoteModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Add Note to Selected Text</h3>
                <button class="modal-close" id="closeAddContentNoteModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>
                        <i class="fas fa-align-left"></i> Selected Text
                    </label>
                    <div id="selectedTextPreview" style="padding: 0.75rem; background: var(--background-light); border-radius: 6px; border: 1px solid var(--border-light); min-height: 40px; color: var(--text-medium); font-style: italic;">
                        No text selected
                    </div>
                </div>
                <div class="form-group">
                    <label for="noteTextInput">
                        <i class="fas fa-sticky-note"></i> Note <span class="required">*</span>
                    </label>
                    <textarea id="noteTextInput" class="form-control" rows="4" placeholder="Enter your note here..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-submit" id="saveContentNoteBtn">
                        <i class="fas fa-save"></i> Save Note
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 共享颜色调色板 -->
    <div class="shared-color-palette" id="sharedColorPalette">
        <div class="color-swatch" data-color="#000000" style="background-color: #000000;"></div>
        <div class="color-swatch" data-color="#FF0000" style="background-color: #FF0000;"></div>
        <div class="color-swatch" data-color="#00FF00" style="background-color: #00FF00;"></div>
        <div class="color-swatch" data-color="#0000FF" style="background-color: #0000FF;"></div>
        <div class="color-swatch" data-color="#FFFF00" style="background-color: #FFFF00;"></div>
        <div class="color-swatch" data-color="#FF00FF" style="background-color: #FF00FF;"></div>
        <div class="color-swatch" data-color="#00FFFF" style="background-color: #00FFFF;"></div>
        <div class="color-swatch" data-color="#FFA500" style="background-color: #FFA500;"></div>
        <div class="color-swatch" data-color="#800080" style="background-color: #800080;"></div>
        <div class="color-swatch" data-color="#FFC0CB" style="background-color: #FFC0CB;"></div>
        <div class="color-swatch" data-color="#A52A2A" style="background-color: #A52A2A;"></div>
        <div class="color-swatch" data-color="#808080" style="background-color: #808080;"></div>
    </div>

    <!-- 添加到生词本模态框 -->
    <div class="modal" id="addVocabularyModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Add New Word</h3>
                <button class="modal-close" id="closeVocabularyModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="vocabularyForm">
                    <div class="form-group">
                        <label for="vocabWord">
                            <i class="fas fa-font"></i> Word <span class="required">*</span>
                        </label>
                        <input type="text" id="vocabWord" name="word" class="form-control" required readonly placeholder="Enter word">
                    </div>

                    <div class="form-group">
                        <label for="vocabDefinition">
                            <i class="fas fa-book"></i> Definition
                        </label>
                        <textarea id="vocabDefinition" name="definition" class="form-control" rows="3" placeholder="Enter definition..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="vocabExample">
                            <i class="fas fa-quote-left"></i> Example Sentence
                        </label>
                        <textarea id="vocabExample" name="example" class="form-control" rows="2" placeholder="Enter example sentence..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-primary">Save Word</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <style>
        /* 添加到生词本模态框的Save Word按钮样式 */
        #addVocabularyModal .form-actions {
            justify-content: flex-end;
            margin-top: 1rem;
            margin-bottom: 0;
            padding-top: 0.75rem;
            padding-bottom: 0;
            border-top: 1px solid var(--border-light);
        }

        #addVocabularyModal .btn-primary {
            background: var(--btn-purple) !important;
            color: white !important;
            border: none !important;
            padding: 0.75rem 1.5rem !important;
            border-radius: 8px !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            box-shadow: var(--shadow-sm) !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
        }

        #addVocabularyModal .btn-primary:hover {
            background: var(--btn-purple-hover) !important;
            transform: translateY(-1px) !important;
            box-shadow: var(--shadow-md) !important;
        }

        /* Vocabulary word tooltip styles */
        .vocabulary-word-marker {
            background: linear-gradient(180deg, transparent 0%, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%, transparent 100%);
            border-bottom: 2px dotted #3B82F6;
            cursor: pointer;
            position: relative;
            padding: 0 2px;
            transition: all 0.2s ease;
        }

        .vocabulary-word-marker:hover {
            background: rgba(59, 130, 246, 0.3);
            border-bottom-color: #2563EB;
        }

        .vocabulary-tooltip {
            position: fixed;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            font-size: 0.875rem;
            white-space: normal;
            max-width: 350px;
            z-index: 10001;
            pointer-events: none;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            pointer-events: auto;
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.6;
            text-align: left;
            display: none;
            box-sizing: border-box;
            visibility: visible;
            opacity: 1;
            padding: 1rem 1.25rem;
        }

        .vocabulary-tooltip .vocab-tooltip-word {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .vocabulary-tooltip .vocab-tooltip-definition {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .vocabulary-tooltip .vocab-tooltip-example {
            font-style: italic;
            opacity: 0.9;
            padding-left: 0.75rem;
            border-left: 2px solid rgba(255, 255, 255, 0.5);
        }

        .vocabulary-tooltip-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            left: 50%;
            transform: translateX(-50%);
        }

        .vocabulary-tooltip-arrow.bottom {
            bottom: -8px;
            border-width: 8px 8px 0 8px;
            border-color: #764ba2 transparent transparent transparent; /* 箭头向下指（tooltip在上方），颜色与tooltip背景一致 */
        }

        .vocabulary-tooltip-arrow.top {
            top: -8px;
            border-width: 0 8px 8px 8px;
            border-color: transparent transparent #764ba2 transparent; /* 箭头向上指（tooltip在下方），颜色与tooltip背景一致 */
        }
    </style>

    <script src="reading.js?v=3"></script>
    <script src="../script.js?v=3"></script>
</body>
</html>

